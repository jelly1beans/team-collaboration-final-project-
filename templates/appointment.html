<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Eye Clinic — Appointment Booking</title>
  <link rel="stylesheet" href="{{url_for('static', filename = 'appointment.css')}}">
</head>
<body>
  <div class="container">
    <div class="card" role="region" aria-label="Appointment booking">
      <h1>Book an Appointment</h1>
      <p class="lead">Fill in your details below and choose a date & time. We'll contact you to confirm.</p>

      <form id="bookingForm" novalidate method="POST" action="{{ url_for('appointment_page') }}">
        <div class="full">
          <label for="fullname">Full name</label>
          <input id="fullname" name="fullname" type="text" placeholder="Ex. Juan Dela Cruz" required aria-required="true">
        </div>

        <div>
          <label for="gender">Gender</label>
          <input id="gender" name="gender" type="text" placeholder="Ex. Male" required aria-required="true">
        </div>

        <div>
          <label for="contact">Contact number</label>
          <input id="contact" name="contact" type="tel" placeholder="+63917xxxxxxx" pattern="^\+?\d{7,15}$" required aria-required="true">
          <small class="note">Include country code (e.g. +63) or start with 09. 7–12 digits.</small>
        </div>

        <div>
          <label for="email">Email address</label>
          <input id="email" name="email" type="email" placeholder="name@example.com" required aria-required="true">
        </div>

        <div>
          <label for="date">Preferred date</label>
          <input id="date" name="date" type="date" required aria-required="true">
        </div>

        <div>
          <label for="time">Preferred time</label>
          <input id="time" name="time" type="time" required aria-required="true">
        </div>

        <div class="full">
          <label for="service">Service</label>
          <select id="service" name="service" required>
            <option value="">-- Choose --</option>
            <option value="Cataract">Cataract</option>
            <option value="Nearsightedness">Nearsightedness</option>
            <option value="Farsightedness">Farsightedness</option>
            <option value="Astigmatism">Astigmatism</option>
            <option value="Presbyopia">Presbyopia</option>
          </select>
        </div>

        <!-- Doctor field -->
        <div class="full" id="doctorField" style="display:none;">
          <label for="doctor">Doctor</label>
          <select id="doctor" name="doctor" required>
            <option value="">-- Select a Doctor --</option>
          </select>
        </div>

        <div class="full">
          <label for="notes">Notes (optional)</label>
          <textarea id="notes" name="notes" placeholder="Any special requirements or additional info..."></textarea>
        </div>

        <div class="full actions">
          <span class="note" id="error" role="status" aria-live="polite"></span>
          <button type="submit">Request appointment</button>
        </div>

        <!-- ✅ Consent checkbox -->
        <div class="full consent">
          <input type="checkbox" id="consent" name="consent" required aria-required="true">
          <label for="consent">
            I hereby agree and consent that <strong>Eye Clinic</strong> may collect, use, disclose, and process my personal 
            information set out in this form to help with my appointment booking, consultation, or request for services. 
            View <a href="{{ url_for('policy_page') }}"target="_blank">Privacy Policy</a>.
          </label>
        </div>
      </form>

      <div id="confirmation" class="success" style="display:none" role="status" aria-live="polite"></div>
    </div>
  </div>

  <script>
    // Helper: format date yyyy-mm-dd
    function localYYYYMMDD(d) {
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth() + 1).padStart(2, '0');
      const dd = String(d.getDate()).padStart(2, '0');
      return `${yyyy}-${mm}-${dd}`;
    }

    // Set min date = today
    const dateInput = document.getElementById('date');
    const today = new Date();
    dateInput.min = localYYYYMMDD(today);

    // Doctor logic
    const serviceSelect = document.getElementById("service");
    const doctorField = document.getElementById("doctorField");
    const doctorSelect = document.getElementById("doctor");

    // Doctors per service
    const doctorsByService = {
      "Cataract": ["Dr. Charles Smith", "Dr. James Lee", "Dr. Leo Marvin"],
      "Nearsightedness": ["Dr. Anna Smith", "Dr. James Lee", "Dr. Charles Garcia"],
      "Farsightedness": ["Dr. Hans Smith", "Dr. Josh Lee", "Dr. Sean Garcia"],
      "Astigmatism": ["Dr. Samantha Smith", "Dr. Hannah Lee", "Dr. Raisy Garcia"],
      "Presbyopia": ["Dr. Hans Smith", "Dr. Sean Lee", "Dr. Raisy Garcia"]
    };

    // Show doctors when service is selected
    serviceSelect.addEventListener("change", function () {
      const service = this.value;
      doctorSelect.innerHTML = '<option value="">-- Select a Doctor --</option>';

      if (service && doctorsByService[service]) {
        doctorField.style.display = "block";
        doctorsByService[service].forEach(doctor => {
          const option = document.createElement("option");
          option.value = doctor;
          option.textContent = doctor;
          doctorSelect.appendChild(option);
        });
      } else {
        doctorField.style.display = "none";
      }
    });
  </script>
</body>
</html>
