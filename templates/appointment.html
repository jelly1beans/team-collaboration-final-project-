<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Eye Clinic — Appointment Booking</title>
  <link rel="stylesheet" href="{{url_for('static', filename = 'appointment.css')}}">
</head>
<body>
  <div class="container">
    <div class="card" role="region" aria-label="Appointment booking">
      <h1>Book an Appointment</h1>
      <p class="lead">Fill in your details below and choose a date & time. We'll contact you to confirm.</p>

      <form id="bookingForm" novalidate>
        <div class="full">
          <label for="fullname">Full name</label>
          <input id="fullname" name="fullname" type="text" placeholder="Ex.Juan Dela Cruz" required aria-required="true">
        </div>
        <div>
          <label for="gender">Gender </label>
          <input id="gender" name="gender" type="text" placeholder="Ex.Male" required aria-required="true">
          </div>

        <div>
          <label for="contact">Contact number</label>
          <input id="contact" name="contact" type="tel" placeholder="+63917xxxxxxx" pattern="^\+?\d{7,15}$" required aria-required="true">
          <small class="note">Include country code (e.g. +63) or start with 09. 7–12 digits.</small>
        </div>

        <div>
          <label for="email">Email address</label>
          <input id="email" name="email" type="email" placeholder="name@example.com" required aria-required="true">
        </div>

        <div>
          <label for="date">Preferred date</label>
          <input id="date" name="date" type="date" required aria-required="true">
        </div>

        <div>
          <label for="time">Preferred time</label>
          <input id="time" name="time" type="time" required aria-required="true">
        </div>

        <div class="full">
          <label for="notes">Notes (optional)</label>
          <textarea id="notes" name="notes" placeholder="Any special requirements or additional info..."></textarea>
        </div>

        <div class="full actions">
          <span class="note" id="error" role="status" aria-live="polite"></span>
          <button type="submit">Request appointment</button>
        </div>
      </form>

      <div id="confirmation" class="success" style="display:none" role="status" aria-live="polite"></div>

    </div>
  </div>

  <script>
    // Helper: format local date as yyyy-mm-dd
    function localYYYYMMDD(d){
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth()+1).padStart(2,'0');
      const dd = String(d.getDate()).padStart(2,'0');
      return `${yyyy}-${mm}-${dd}`;
    }

    const dateInput = document.getElementById('date');
    const today = new Date();
    dateInput.min = localYYYYMMDD(today);

    const form = document.getElementById('bookingForm');
    const errorEl = document.getElementById('error');
    const conf = document.getElementById('confirmation');

    form.addEventListener('submit', function(e){
      e.preventDefault();
      errorEl.textContent = '';
      conf.style.display = 'none';

      const fullname = form.fullname.value.trim();
      const contact = form.contact.value.trim();
      const email = form.email.value.trim();
      const date = form.date.value;
      const time = form.time.value;
      const service = form.service.value;

      if(!fullname || !contact || !email || !date || !time || !service || !doctor){
        errorEl.textContent = 'Please fill in all required fields.';
        return;
      }

      const phoneRe = /^\+?\d{7,15}$/;
      if(!phoneRe.test(contact)){
        errorEl.textContent = 'Contact number seems invalid. Use 7–12 digits, optional + country code.';
        return;
      }

      const chosen = new Date(date + 'T00:00:00');
      const startOfToday = new Date(localYYYYMMDD(new Date()) + 'T00:00:00');
      if(chosen < startOfToday){
        errorEl.textContent = 'Please choose today or a future date.';
        return;
      }

      conf.innerHTML = `<strong>Appointment requested!</strong>
        <div style="margin-top:8px">Thank you, <strong>${escapeHtml(fullname)}</strong>. We received your request for <strong>${escapeHtml(service)}</strong> with <strong>${escapeHtml(doctor)}</strong> on <strong>${escapeHtml(date)}</strong> at <strong>${escapeHtml(time)}</strong>.<br>
        We will contact you at <strong>${escapeHtml(contact)}</strong> or <strong>${escapeHtml(email)}</strong> to confirm the appointment.</div>`;
      conf.style.display = 'block';

      form.reset();
      dateInput.min = localYYYYMMDD(new Date());
    });

    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, function(c){
        return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c];
      });
    }
  </script>
</body>
</html>
