<!DOCTYPE html>
<html lang="en">
<head>
    <title>Webpage Design</title>
    <link rel="stylesheet" href="{{url_for('static', filename = 'design.css')}}">
</head>

<body>
    <nav class="navbar">
    <div class="logo-container">
      <img src="{{ url_for('static', filename='image/logo.png') }}" alt="VISIONEASE Logo" class="logo">
    </div>
    <ul class="nav-menu">
      <li><a href="#">HOME</a></li>
      <li><a href="#missionVisionSection">ABOUT US</a></li>
      <li><a href="#mainSection">SERVICE</a></li>
    </ul>
     <ul class="nav-menu-right">
      <li><a href="{{ url_for('landing_page') }}">PATIENT</a></li>
      <li><a href="{{ url_for('assistant_page') }}">ASSISTANT</a></li>
    </ul>
  </nav>

        <div class="content">
           <div class="notes-content">
                <h1>Ophthalmology Healthcare System:</h1>
                <h2>Digital platform for appointment scheduling and patient management</h2>
                <p>Experience the benefits of Ophthalmology Healthcare and transform the way you deliver eye care services. Our platform is designed to improve patient outcomes, enhance efficiency, and increase accessibility. Join us in revolutionizing eye care.</p>            </div>

<form action="{{ url_for('signup_page') }}" method="post" autocomplete="off">
  <input type="hidden" name="next" value="{{ next_page }}">

  <div class="form">
    <h3 style="text-align: center; font-size: 30px;">SignUp</h3>

    <input type="text" name="name" placeholder="Your Name" required autocomplete="off" />
    <input type="email" name="email" placeholder="Your Email" required autocomplete="off" />
    <input type="password" name="password" placeholder="Password" required autocomplete="off" />

    <button class="signup_btn" type="submit">SignUp</button>

    <p class="statement">
      Have already an account?
      <a href="{{ url_for('login_page', next=next_page) }}"><u>Login here</u></a>
    </p>
  </div>
</form>
        </div>
        {% with messages = get_flashed_messages(with_categories=true) %}
              {% if messages %}
            <div class="flash-message-container">
              {% for category, message in messages %}
            <div class="flash-message {{ category }}">{{ message }}</div>
              {% endfor %}
            </div>
              {% endif %}
            {% endwith %}
</header>
<br>
  <!-- Mission and Vision Section -->
  
<section class="mission-vision-container" id="missionVisionSection">
  <br>
  <h1 class="section-title">Our Mission & Vision</h1>
    <div class="section">
      <h2 class="title">MISSION</h2>
      <div class="box">
        <p>
          Our mission is to deliver an intuitive and efficient digital platform for Accessible Optiomology eye Healthcare, 
          streamlining appointment scheduling and comprehensive patient management. We are dedicated to connecting patients 
          with specialized eye care professionals, enhancing health outcomes, and fostering a patient-centric ecosystem 
          that ensures timely and personalized care for all.
        </p>
      </div>
    </div>

    <div class="section">
      <h2 class="title">VISION</h2>
      <div class="box">
        <p>
          To foster a vibrant and healthy Filipino society by guaranteeing equitable access to specialized eye care, 
          leveraging technology to make ophthalmological services convenient, efficient, and deeply personalized for every patient.
        </p>
      </div>
    </div>

  </section>
<br><br>

  <!-- Services Section -->

<h1 class="section-title">What We Offer</h1>
<section id="mainSection" class="card-container">
    <div class="card">
      <h3>Nearsightedness</h3>
      <p>Difficulty seeing distant objects clearly.</p>
      <button class="view-btn" onclick="showDoctors('nearsightedness')">View More</button>
    </div>

    <div class="card">
      <h3>Farsightedness</h3>
      <p>Difficulty focusing on close objects.</p>
      <button class="view-btn" onclick="showDoctors('farsightedness')">View More</button>
    </div>

    <div class="card">
      <h3>Astigmatism</h3>
      <p>Blurred vision caused by irregular cornea shape.</p>
      <button class="view-btn" onclick="showDoctors('astigmatism')">View More</button>
    </div>

    <div class="card">
      <h3>Cataract</h3>
      <p>Clouding of the eye’s lens causing blurry vision.</p>
      <button class="view-btn" onclick="showDoctors('cataract')">View More</button>
    </div>

    <div class="card">
      <h3>Presbyopia</h3>
      <p>Age-related loss of near vision.</p>
      <button class="view-btn" onclick="showDoctors('presbyopia')">View More</button>
    </div>
  </section>

  <!-- Doctors Section -->
  <section id="doctorList">
    <button class="back-btn" onclick="goBack()">← Back</button>
    <h2 id="doctorTitle">Available Doctors</h2>
    <div id="doctorCards"></div>
  </section>

  <script>
  const doctorData = {
    nearsightedness: [
      { name: "Dr. Anna Smith", specialty: "Ophthalmologist - Myopia Specialist", img: "{{ url_for('static', filename='image/doc anna.jpg') }}" },
      { name: "Dr. James Lee", specialty: "Optometrist - Vision Correction", img: "{{ url_for('static', filename='image/doctor2.jpg') }}" },
      { name: "Dr. Charles Garcia", specialty: "Refractive Surgery Specialist", img: "{{ url_for('static', filename='image/doctor3.jpg') }}" }
    ],
    farsightedness: [
      { name: "Dr. Hans Smith", specialty: "Opthalmologist - Hyperopia Specialist", img: "{{ url_for('static', filename='image/doc hans.jpg') }}" },
      { name: "Dr. Josh Lee", specialty: "Optometrist - Vision Correction", img: "{{ url_for('static', filename='image/doc josh.jpg') }}" },
      { name: "Dr. Sean Garcia", specialty: "Refractive Surgery Specialist", img: "{{ url_for('static', filename='image/doc sean.jpg') }}" }
    ],
    astigmatism: [
      { name: "Dr. Samantha Smith", specialty: "Optometrist - Astigmatism Correction", img: "{{ url_for('static', filename='image/doc susan.jpg') }}" },
      { name: "Dr. Hannah Lee", specialty: "Opthalmologist - Corneal Specialist", img: "{{ url_for('static', filename='image/doc hannah.jpg') }}" },
      { name: "Dr. Raisy Garcia", specialty: "Contact Lens Specialist", img: "{{ url_for('static', filename='image/doc raisy.jpg') }}" }
    ],
    cataract: [
      { name: "Dr. Charles Garcia", specialty: "Ophthalmologist, Cataract Surgery Specialist", img: "{{ url_for('static', filename='image/doctor3.jpg') }}" },
      { name: "Dr. James Lee", specialty: "Senior Eye Care Specialist", img: "{{ url_for('static', filename='image/doctor2.jpg') }}" },
      { name: "Dr. Leo Marvin", specialty: "Ophthalmic Surgeon (Lens Replacement)", img: "{{ url_for('static', filename='image/DOCTOR1.jpg') }}" }
    ],
    presbyopia: [
      { name: "Dr. Hans Smith", specialty: "Opthalmologist - Age-related Vision Specialist", img: "{{ url_for('static', filename='image/doc hans.jpg') }}" },
      { name: "Dr. Sean Lee", specialty: "Optometrist - Progressive Lens Expert", img: "{{ url_for('static', filename='image/doc sean.jpg') }}" },
      { name: "Dr. Raisy Garcia", specialty: "Refractive Surgery Specialist(Multifocal Implants)", img: "{{ url_for('static', filename='image/doc sean.jpg') }}" }
    ]
  };


  function showDoctors(illness) {
    const main = document.getElementById('mainSection');
    const list = document.getElementById('doctorList');
    const doctorCards = document.getElementById('doctorCards');
    const title = document.getElementById('doctorTitle');

    doctorCards.innerHTML = '';
    title.textContent = `Doctors for ${illness.charAt(0).toUpperCase() + illness.slice(1)}`;

    doctorData[illness].forEach(doc => {
      const div = document.createElement('div');
      div.className = 'doctor-card';
      div.innerHTML = `
        <img src="${doc.img}" alt="${doc.name}">
        <div>
          <h4>${doc.name}</h4>
          <p>${doc.specialty}</p>
          <button class="book-btn" onclick="bookAppointment('${doc.name}')">Book Appointment</button>
        </div>
      `;
      doctorCards.appendChild(div);
    });

    main.style.display = 'none';
    list.style.display = 'block';
  }

  function goBack() {
    document.getElementById('doctorList').style.display = 'none';
    document.getElementById('mainSection').style.display = 'flex';
  }

  // ✅ Book Appointment Logic
  async function bookAppointment(doctorName) {
    sessionStorage.setItem("selectedDoctor", doctorName);

    let selectedService = "";
    for (const [service, doctors] of Object.entries(doctorData)) {
      if (doctors.some(doc => doc.name === doctorName)) {
        selectedService = service.charAt(0).toUpperCase() + service.slice(1);
        break;
      }
    }
    sessionStorage.setItem("selectedService", selectedService);

    // Step 1: Check login
    const loginRes = await fetch("/check_login");
    const loginData = await loginRes.json();

    if (loginData.logged_in) {
      window.location.href = `/appointment?doctor=${encodeURIComponent(doctorName)}`;
      return;
    }

    // Step 2: Show email modal if not logged in
showEmailModal(async (email) => {
  // Step 3: Check if email exists
  const emailRes = await fetch("/check_email_exists", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email }),
  });
  const emailData = await emailRes.json();

  const nextPage = `/appointment?doctor=${encodeURIComponent(doctorName)}`;

  if (emailData.exists) {
    alert("Account found! Redirecting to login...");
    window.location.href = `/Login?next=${encodeURIComponent(nextPage)}`;
  } else {
    alert("No account found. Redirecting to signup...");
    window.location.href = `/SignUp?next=${encodeURIComponent(nextPage)}`;
  }
});

    // Step 3: Check if email exists
    const emailRes = await fetch("/check_email_exists", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email }),
    });
    const emailData = await emailRes.json();

    const nextPage = `/appointment?doctor=${encodeURIComponent(doctorName)}`;

    if (emailData.exists) {
      alert("Account found! Redirecting to login...");
      window.location.href = `/Login?next=${encodeURIComponent(nextPage)}`;
    } else {
      alert("No account found. Redirecting to signup...");
      window.location.href = `/SignUp?next=${encodeURIComponent(nextPage)}`;
    }
  }

  function showEmailModal(callback) {
  const modal = document.getElementById("emailModal");
  const emailInput = document.getElementById("emailInput");
  const cancelBtn = document.getElementById("emailCancel");
  const submitBtn = document.getElementById("emailSubmit");

  modal.style.display = "flex";
  emailInput.focus();

  // Close modal
  cancelBtn.onclick = () => {
    modal.style.display = "none";
  };

  // Submit email
  submitBtn.onclick = () => {
    const email = emailInput.value.trim();
    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

    if (!emailPattern.test(email)) {
      emailInput.style.border = "1px solid red";
      emailInput.placeholder = "Please enter a valid email";
      return;
    }

    modal.style.display = "none";
    callback(email); // Pass email to main logic
  };

  // Close when clicking outside modal
  window.onclick = (e) => {
    if (e.target === modal) {
      modal.style.display = "none";
    }
  };
}

</script>
<!-- Email Modal -->
<div id="emailModal" class="modal-overlay">
  <div class="modal-box">
    <h2>Enter your Email</h2>
    <p>Please enter your email to continue booking your appointment.</p>
    <input type="email" id="emailInput" placeholder="example@gmail.com" required />
    <div class="modal-buttons">
      <button id="emailCancel">Cancel</button>
      <button id="emailSubmit">Continue</button>
    </div>
  </div>
</div>


</body>
</html>