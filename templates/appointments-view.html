<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Doctor Appointments</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='Adoctors.css') }}">
</head>
<body>
  <!-- ----------------- NAVBAR ----------------- -->
  <header class="navbar">
    <div class="logo-container">
      <img src="{{ url_for('static', filename='image/logo.png') }}" alt="VISIONEASE Logo" class="logo">
    </div>
    <div class="title"><h3>{{ assistant.Assistant_name or 'User' }}</h3></div>
    <div class="menu" id="menu-btn">
      <div class="dot"></div>
      <div class="dot"></div>
      <div class="dot"></div>
    </div>
  </header>

  <!-- ----------------- SIDEBAR ----------------- -->
  <div class="sidebar" id="sidebar">
    <div class="close-btn" id="close-btn">&times;</div>
    <h3>Navigation</h3>
    <a href="#">Dashboard</a>
    <a href="{{url_for('doctors_schedule')}}">Doctors</a>
    <a href="{{url_for('view_appointments')}}">Appointments</a>
    <a href="{{url_for('assistant_profile_page')}}">Profile</a>
    <a href="{{url_for('assistant_logout')}}">Logout</a>
  </div>

  <!-- ----------------- MAIN CONTENT ----------------- -->
  <main>
    <h2 class="page-title">DOCTORSâ€™ APPOINTMENT</h2>
    <table class="appointment-table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Date</th>
          <th>Time</th>
          <th>Service</th>
          <th>Doctor</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>

      <tbody>
        {% for a in appointment %}
        <tr>
          <td>{{ a.fullname }}</td>
          <td>{{ a.appt_date }}</td>
          <td>{{ a.appt_time }}</td>
          <td>{{ a.service }}</td>
          <td>{{ a.doctor }}</td>
          <td>{{ a.status or 'Pending' }}</td>
          <td>
            {% if a.status != 'Accepted' and a.status != 'Declined' %}
              <!-- Accept button -->
              <form action="{{ url_for('accept_appointment') }}" method="POST" style="display:inline;">
                <input type="hidden" name="appointment_id" value="{{ a.appointment_id }}">
                <button type="submit" class="action-btn accept-btn">Accept</button>
              </form>

              <!-- Decline button -->
              <form action="{{ url_for('decline_appointment') }}" method="POST" style="display:inline;" onsubmit="return confirmDecline(this);">
                <input type="hidden" name="appointment_id" value="{{ a.appointment_id }}">
                <input type="hidden" name="decline_message" value="">
                <button type="submit" class="action-btn decline-btn">Decline</button>
              </form>
            {% elif a.status == 'Accepted' %}
              <button class="action-btn accept-btn" disabled>Accepted</button>
            {% elif a.status == 'Declined' %}
              <button class="action-btn decline-btn" disabled>Declined</button>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </main>

  <!-- ----------------- FLASH MESSAGES ----------------- -->
  {% with messages = get_flashed_messages() %}
  {% if messages %}
    <div class="flash-message-container">
      {% for message in messages %}
        <div class="flash-message">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}
  {% endwith %}

  <!-- ----------------- SCRIPTS ----------------- -->
  <script>
    // Sidebar open/close
    const menuBtn = document.getElementById('menu-btn');
    const sidebar = document.getElementById('sidebar');
    const closeBtn = document.getElementById('close-btn');

    menuBtn.addEventListener('click', () => {
      sidebar.classList.add('active');
    });

    closeBtn.addEventListener('click', () => {
      sidebar.classList.remove('active');
    });

    // Click outside sidebar to close
    document.addEventListener('click', (event) => {
      if (!sidebar.contains(event.target) && !menuBtn.contains(event.target)) {
        sidebar.classList.remove('active');
      }
    });

    // Decline message confirmation
    function confirmDecline(form) {
      const message = prompt("Please enter a reason for declining this appointment:");
      if (message === null || message.trim() === "") {
        alert("Decline message is required.");
        return false;
      }
      form.querySelector('input[name="decline_message"]').value = message.trim();
      return true;
    }
  </script>
</body>
</html>
